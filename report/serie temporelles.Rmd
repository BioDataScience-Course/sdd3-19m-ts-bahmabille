---
title: "Série spatio-temporelle"
author: "Guyliann Engels & Philippe Grosjean"
output: github_document
---


## Objectifs

Nous attendons des rapports individuels liés à chaque situation présentée précédement sous le format d'un R Markdown ( format de sortie libre). Il ne s'agit pas de rapports scientifiques conventionnels dont vous connaissez bien la structure (introduction, matériels & méthodes, but, ....).

Vous devez considérer ces rapports comme des carnets de laboratoires. Lors d'une expérience, tout est consigné dans le carnet de laboratoire.

Votre rapport doit respecter la logique suivante :

- But : Quelle est la question que vous vous posez ? Cette information se trouve dans la section ci-dessus.


- Analyse : Cette section doit montrer l'évolution de votre analyse des données. Chaque graphiqe ou chaque modèle doit être commenté dans le texte en dessous de ce dernier.


**Note :** Les données sont mises à votre disposition au sein du dépôt dans le dossier data

## Contexte

11 analyses vous sont demandées dont les contextes vous sont expliqués ci-dessous.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#??????????
```


### Croissance d'arbres

Les scientifiques mesurent l'épaisseur de cernes (en cm) sur des arbres abattus en 1973. Décomposez cette série avec la méthode des moyennes mobiles

```{r,fig.align='center', echo=FALSE, out.width= '65%'}
knitr::include_graphics("images/arbre.jpg")
```

> Jeu de données : cernes.txt

```{r}
library(readr)
cernes <- read_csv("../data/cernes.txt")
#View(cernes)

class(cernes) 
#[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" 

cernes_ts <- ts(cernes, start = 1.000, frequency = 1) 
cernes_ts

time(cernes_ts) 
plot(cernes_ts) 
acf(cernes_ts)

#cernes.stat <- stat.slide(time(cernes_ts), cernes_ts, xmin = 1.000, deltat = 110)
#cernes.stat
#plot(cernes.stat) 
#ca n'a pas de sens de faire ds statistiques glissantes ici puisque toutes les donnees ont ete collecttionnees la meme année.
```

```{r}
## Identification de tendance à long terme
# Tendance globale
library(pastecs)
# Test par bootstrap
(cernes_trend_test <- trend.test(cernes_ts, R = 999))
#original = coeff correlation, bias = asymétrie, erreur standard= ecart-type par rapport à la distribution normale => le plus important c'est le graphique.
#original= 0.066 : correlation directe négligeable.

plot(cernes_trend_test)
##droite pointillée aux extremes= p faible= p<alpha = on rejette Ho il y a donc une tendance générale.
#qqplot: ronds noirs = observations suivent bien la droite pointillée, donc la distribution est normale.

# Valeur p associée au test bootstrappé
cernes_trend_test$p.value
# Valeur p associée au test bootstrappé : 0,032 < 0,05 -> tendance significative au seuil alpha de 5%
```


### Variation de la température 

Les chercheurs rencensent la température moyenne mensuelle à Melbourne à partir de janvier 1981. Y a t'il une augmentation de la température au cours du temps ? 

> Jeu de données : temperature_melbourne_1981

```{r,fig.align='center', echo=FALSE, out.width= '65%'}
knitr::include_graphics("images/temperature.jpg")
```

```{r}
library(readr)
temperature_melbourne_1981 <- read_csv("../data/temperature_melbourne_1981.csv")
#View(temperature_melbourne_1981)

class(temperature_melbourne_1981) 

temp_ts <- ts(temperature_melbourne_1981$temp_mean, start = 1981, frequency = 12) 
temp_ts

time(temp_ts) 
plot(temp_ts) 
acf(temp_ts)

cycle(temp_ts)
split(temp_ts, cycle(temp_ts))
boxplot(split(temp_ts, cycle(temp_ts)))

notma.stat <- stat.slide(time(temp_ts), temp_ts, xmin = 1981, deltat = 3)
notma.stat

plot(notma.stat) 

```


```{r}
## Identification de tendance à long terme
# Tendance globale
library(pastecs)
# Test par bootstrap
(temp_trend_test <- trend.test(temp_ts, R = 999))
#original = coeff correlation, bias = asymétrie, erreur standard= ecart-type par rapport à la distribution normale => le plus important c'est le graphique.
#original= 0.026 : correlation direct négligeable.

plot(temp_trend_test)
#droite pointillée au milieu de l'histogramme = p élevé = p > alpha = on ne rejette pas Ho il n'y a donc pas de tendance générale.
#qqplot: ronds noirs = observations suivent bien la droite pointillée, donc la distribution est normale.

# Valeur p associée au test bootstrappé
temp_trend_test$p.value
# Valeur p associée au test bootstrappé : 0.767 > 0,05 -> pas tendance significative au seuil alpha de 5%
```

### Transect de Nice à Calvi

Les chercheurs souhaitent visualiser graphiquement la distribution des Copépodes le long du transect (Variable Copepodits1).

```{r, echo= FALSE, message=FALSE, out.width= '50%', fig.align='center'}
library(tidyverse)
library(cowplot)
fr <- map_data("france")
ggplot(fr, aes(long, lat, group = group)) +
  geom_polygon(fill= "white", color = "black") +
  geom_segment(aes(y = 43.7 , x = 7.25, yend = 42.56, xend= 8.75, color = "red"), size = 1, show.legend = FALSE) +
  theme(axis.line = element_blank(), axis.title = element_blank(),axis.text = element_blank(), axis.ticks = element_blank()) +
  coord_quickmap()
```

```{r}
library(readr)
data(marbio)
marbio

class(marbio) 

marbio_ts <- ts(marbio$Copepodits1, start = 1.000, frequency = 1) 
marbio_ts

time(marbio_ts) 
plot(marbio_ts) 
acf(marbio_ts)
```


```{r}
## Identification de tendance à long terme
# Tendance globale
library(pastecs)
# Test par bootstrap
(marbio_trend_test <- trend.test(marbio_ts, R = 999))
#original = coeff correlation, bias = asymétrie, erreur standard= ecart-type par rapport à la distribution normale => le plus important c'est le graphique.
#original= 0.68 : correlation direct non négligeable.

plot(marbio_trend_test)
##droite pointillée aux extremes= p faible= p<alpha = on rejette Ho il y a donc une tendance générale.
#qqplot: ronds noirs = observations suivent bien la droite pointillée, donc la distribution est normale.

# Valeur p associée au test bootstrappé
marbio_trend_test$p.value
# Valeur p associée au test bootstrappé : 0 < 0,05 -> tendance significative au seuil alpha de 5%
```

> Jeu de données : Marbio du package (Pastecs)

### Production de lait 

La production mensuelle de lait par vache est monitoré à partir de janvier 1926. Y a t'il une évolution linéaire? Le cycle annuel est modélisable ? 

```{r,fig.align='center', echo=FALSE, out.width= '65%'}
knitr::include_graphics("images/vache.jpg")
```




```{r}
library(readr)
milK_product_1962 <- read_csv("../data/milK_product_1962.csv")
milK_product_1962


class(milK_product_1962) 

milK_ts <- ts(milK_product_1962$product, start = 1962, frequency = 12) #on met f=1 car pas précisé, une observation par jour.
milK_ts

time(milK_ts) 
plot(milK_ts) 
acf(milK_ts)

cycle(milK_ts)
split(milK_ts, cycle(milK_ts))
boxplot(split(milK_ts, cycle(milK_ts)))


milk.stat <- stat.slide(time(milK_ts), milK_ts, xmin = 1962, deltat = 6)
milk.stat

plot(milk.stat) 

```

```{r}
## Identification de tendance à long terme
# Tendance globale
library(pastecs)
# Test par bootstrap
(milK_trend_test <- trend.test(milK_ts, R = 999))
#original = coeff correlation, bias = asymétrie, erreur standard= ecart-type par rapport à la distribution normale => le plus important c'est le graphique.
#original= 0.816 : correlation direct non négligeable.

plot(milK_trend_test)
##droite pointillée aux extremes= p faible= p<alpha = on rejette Ho il y a donc une tendance générale.
#qqplot: ronds noirs = observations suivent bien la droite pointillée, donc la distribution est normale.

# Valeur p associée au test bootstrappé
milK_trend_test$p.value
# Valeur p associée au test bootstrappé : 0 < 0,05 ->  tendance significative au seuil alpha de 5%
```

> Jeu de données : milk_product_1962

### Variation de la population en Australie

Les chercheurs rencensent mensuellement le population Australienne à partir de 1978. Ils souhaitent savoir si la croissance a été linéaire. 

> jeu de données : demographie.txt

```{r,fig.align='center', echo=FALSE, out.width= '65%'}
knitr::include_graphics("images/australie.jpg")
```

```{r}
library(readr)
demographie <- read_csv("../data/demographie.txt")
#View(demographie)

class(demographie) 

demo_ts <- ts(demographie, start = 1978, frequency = 12) 
demo_ts

time(demo_ts) 
plot(demo_ts)
acf(demo_ts) 


demo.stat <- stat.slide(time(demographie_ts), demographie_ts, xmin = 1978, deltat = 6)
demo.stat

plot(demo.stat) 
```



```{r}
## Identification de tendance à long terme
# Tendance globale
library(pastecs)
# Test par bootstrap
(demo_trend_test <- trend.test(demo_ts, R = 999))
#original = coeff correlation, bias = asymétrie, erreur standard= ecart-type par rapport à la distribution normale => le plus important c'est le graphique.
#original= 1 : correlation direct maximale.

plot(demo_trend_test)
##droite pointillée aux extremes= p faible= p<alpha = on rejette Ho il y a donc une tendance générale.
#qqplot: ronds noirs = observations suivent bien la droite pointillée, donc la distribution est normale.

# Valeur p associée au test bootstrappé
demo_trend_test$p.value
# Valeur p associée au test bootstrappé : 0 < 0,05 -> tendance significative au seuil alpha de 5%
```
